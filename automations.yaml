- id: '1767172045024'
  alias: Calendar Event Reminder
  description: Play a reminder sound 5 minutes before any family calendar event
  triggers:
  - entity_id: calendar.family
    event: start
    offset: -00:05:00
    trigger: calendar
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: person.yoshi
      state:
      - home
    - condition: state
      entity_id: person.queen
      state:
      - home
  actions:
  - action: tts.cloud_say
    metadata: {}
    data:
      cache: true
      entity_id: media_player.all_speakers
      message: It's almost time for {{ trigger.calendar_event.summary }}
  mode: single
- id: '1767182652954'
  alias: Bedtime Reminder
  description: Play bedtime reminder with optional phone charging warnings
  triggers:
  - trigger: time
    at: '22:25:00'
  conditions: []
  actions:
  - variables:
      core_message: It's almost time to sleep.
      yoshi_should_charge: '{{ states(''binary_sensor.yoshi_should_charge_50'')|bool
        }}'
      queen_should_charge: '{{ states(''binary_sensor.queen_should_charge_50'')|bool
        }}'
      battery_warnings: "{% if yoshi_should_charge and queen_should_charge %}\n  Yoshi
        and QP, you should charge your phones.\n{% elif yoshi_should_charge %}\n  Yoshi,
        you should charge your phone\n{% elif queen_should_charge %}\n  QP, you should
        charge your phone\n{% else %}\n  \"\"\n{% endif %}"
      final_message: '{{ (core_message + '' '' + battery_warnings).strip() }}'
  - action: tts.speak
    metadata: {}
    target:
      entity_id: tts.home_assistant_cloud
    data:
      cache: true
      media_player_entity_id: media_player.all_speakers
      message: '{{ final_message }}'
  mode: single
- id: '1767232822685'
  alias: Phone charge reminder
  description: Remind family to charge their phone during the day
  triggers:
  - trigger: time_pattern
    hours: '*'
  conditions:
  - condition: and
    conditions:
    - condition: time
      after: 09:00:00
      before: '22:00:00'
    - condition: state
      entity_id: binary_sensor.someone_should_charge_25
      state:
      - 'on'
  actions:
  - action: tts.cloud_say
    metadata: {}
    data:
      cache: false
      entity_id: media_player.all_speakers
      message: '{{ state_attr(''binary_sensor.someone_should_charge_25'', ''message'')
        }}'
  mode: single
- id: office1_light_on_presence
  alias: Office 1 Light On When Presence Detected
  description: Turn on the office light when presence is detected and it's dark
  triggers:
  - trigger: state
    entity_id: binary_sensor.office_1_presence_sensor_occupancy
    to: 'on'
  - trigger: state
    entity_id: sensor.office_1_presence_sensor_illumination
    to: dim
  conditions:
  - condition: state
    entity_id: binary_sensor.office_1_presence_sensor_occupancy
    state: 'on'
  - condition: state
    entity_id: sensor.office_1_presence_sensor_illumination
    state: dim
  - condition: state
    entity_id: light.office_light_1
    state: 'off'
  actions:
  - action: light.turn_on
    target:
      entity_id: light.office_light_1
  mode: single
- id: office1_ac_heating_on_presence
  alias: Office 1 AC Heating When Cold
  description: Turn on AC in heating mode when presence detected and temperature is
    below minimum comfortable
  triggers:
  - trigger: state
    entity_id: binary_sensor.office_1_presence_sensor_occupancy
    to: 'on'
  conditions:
  - condition: template
    value_template: "{{ states('sensor.office_1_climate_sensor_temperature') | float
      <\n   states('number.office_1_climate_sensor_comfort_temperature_min') | float
      }}"
  - condition: state
    entity_id: climate.office_ac_1
    state:
    - 'off'
  actions:
  - action: climate.set_hvac_mode
    target:
      entity_id: climate.office_ac_1
    data:
      hvac_mode: heat
  mode: single
- id: office1_ac_cooling_on_presence
  alias: Office 1 AC Cooling When Hot
  description: Turn on AC in cooling mode when presence detected and temperature is
    above maximum comfortable
  triggers:
  - trigger: state
    entity_id: binary_sensor.office_1_presence_sensor_occupancy
    to: 'on'
  conditions:
  - condition: template
    value_template: "{{ states('sensor.office_1_climate_sensor_temperature') | float
      >\n   states('number.office_1_climate_sensor_comfort_temperature_max') | float
      }}"
  - condition: state
    entity_id: climate.office_ac_1
    state:
    - 'off'
  actions:
  - action: climate.set_hvac_mode
    target:
      entity_id: climate.office_ac_1
    data:
      hvac_mode: cool
  mode: single
- id: office1_turn_off_no_presence
  alias: Office 1 Turn Off After No Presence
  description: Turn off light and AC when no presence detected for 15 minutes
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.office_1_presence_sensor_occupancy
    to:
    - 'off'
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id: light.office_light_1
  - action: climate.turn_off
    target:
      entity_id: climate.office_ac_1
  mode: single
- id: ac_auto_climate_mode
  alias: AC Auto Climate Mode Based on Temperature
  description: When an AC is turned on (from off or unknown), automatically set heat
    mode if cold or cool mode if hot based on room comfort settings
  triggers:
  - trigger: state
    entity_id:
    - climate.office_ac_1
    - climate.office_ac_2
    - climate.main_ac
    - climate.main_ac_2
    - climate.bedroom_ac
    - climate.guest_bedroom_ac
    from:
    - 'off'
    - unknown
  conditions: []
  actions:
  - variables:
      ac_to_sensor:
        climate.office_ac_1:
          temp: sensor.office_1_climate_sensor_temperature
          comfort_min: number.office_1_climate_sensor_comfort_temperature_min
          comfort_max: number.office_1_climate_sensor_comfort_temperature_max
        climate.office_ac_2:
          temp: sensor.office_2_climate_sensor_temperature
          comfort_min: number.office_2_climate_sensor_comfort_temperature_min
          comfort_max: number.office_2_climate_sensor_comfort_temperature_max
        climate.main_ac:
          temp: sensor.living_room_climate_sensor_temperature
          comfort_min: number.living_room_climate_sensor_comfort_temperature_min
          comfort_max: number.living_room_climate_sensor_comfort_temperature_max
        climate.main_ac_2:
          temp: sensor.living_room_climate_sensor_temperature
          comfort_min: number.living_room_climate_sensor_comfort_temperature_min
          comfort_max: number.living_room_climate_sensor_comfort_temperature_max
        climate.bedroom_ac:
          temp: sensor.bedroom_climate_sensor_temperature
          comfort_min: number.bedroom_climate_sensor_comfort_temperature_min
          comfort_max: number.bedroom_climate_sensor_comfort_temperature_max
        climate.guest_bedroom_ac:
          temp: sensor.guest_bedroom_climate_sensor_temperature
          comfort_min: number.guest_bedroom_climate_sensor_comfort_temperature_min
          comfort_max: number.guest_bedroom_climate_sensor_comfort_temperature_max
      sensors: '{{ ac_to_sensor.get(trigger.entity_id, {}) }}'
      current_temp: '{{ states(sensors.temp) | float if sensors else 0 }}'
      comfort_min: '{{ states(sensors.comfort_min) | float if sensors else 0 }}'
      comfort_max: '{{ states(sensors.comfort_max) | float if sensors else 0 }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ sensors and current_temp < comfort_min }}'
      sequence:
      - action: climate.set_hvac_mode
        target:
          entity_id: '{{ trigger.entity_id }}'
        data:
          hvac_mode: heat
    - conditions:
      - condition: template
        value_template: '{{ sensors and current_temp > comfort_max }}'
      sequence:
      - action: climate.set_hvac_mode
        target:
          entity_id: '{{ trigger.entity_id }}'
        data:
          hvac_mode: cool
  mode: parallel
  max: 6
